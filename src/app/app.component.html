<div class="container">
  <h1>Aircraft Search</h1>
  <form (ngSubmit)="onSubmit()">
    <mat-radio-group [(ngModel)]="searchType" name="searchType">
      <mat-radio-button value="aircraft" [checked]="searchType === 'aircraft'"
        (change)="onSearchTypeChange('aircraft')">Search by Registration
      </mat-radio-button>
      <mat-radio-button value="callsign" [checked]="searchType === 'callsign'"
        (change)="onSearchTypeChange('callsign')">Search by Callsign</mat-radio-button>
    </mat-radio-group>
    <mat-form-field>
      <mat-label>Enter values (comma-separated)</mat-label>
      <input matInput [(ngModel)]="queries" name="queries" placeholder="eg: N12345, N54321 or UAL123, DAL456" />
    </mat-form-field>
    <button mat-raised-button color="primary" type="submit">Search</button>
  </form>

  @if (loading()) {
  <div class="spinner-container">
    <mat-spinner></mat-spinner>
  </div>
  } @else {

  <div class="results">
    @if (searchValue === 'aircraft' && aircraftResults.length > 0) { @for
    (aircraft of aircraftResults; track aircraft.query) {
    <mat-card class="example-card" appearance="outlined">
      <mat-card-header>
        <mat-card-title-group class="title-group">
          <mat-card-title>{{ aircraft.query }}</mat-card-title>
          @if (aircraft.data?.url_photo_thumbnail) {
          <img mat-card-md-image [src]="aircraft.data?.url_photo_thumbnail" alt="Aircraft" class="photo" />
          } @else {
          <img mat-card-md-image src="/assets/aircraft.png" alt="Aircraft Photo" class="photo" />
          }
        </mat-card-title-group>
      </mat-card-header>

      @if (aircraft.error) {
      <mat-card-content>
        <p class="error">{{ aircraft.error }}</p>
      </mat-card-content>
      } @else {

      <mat-card-content>
        <mat-list>
          <mat-list-item>Type: {{ aircraft.data?.type }}</mat-list-item>
          <mat-list-item>Manufacturer: {{ aircraft.data?.manufacturer }}</mat-list-item>
          <mat-list-item>Registration: {{ aircraft.data?.registration }}</mat-list-item>
          <mat-list-item>Owner: {{ aircraft.data?.registered_owner }}</mat-list-item>
        </mat-list>
      </mat-card-content>

      }
    </mat-card>
    } } @else if (searchValue === 'callsign' && flightRouteResults.length > 0) {
    @for(flightRoute of flightRouteResults; track flightRoute.query) {

    <mat-card class="example-card" appearance="outlined">
      <mat-card-header>
        <mat-card-title>{{ flightRoute.query }}</mat-card-title>
      </mat-card-header>

      @if (flightRoute.error) {
      <mat-card-content>
        <p class="error">{{ flightRoute.error }}</p>
      </mat-card-content>
      } @else {

      <mat-card-content>
        <mat-list>
          <mat-list-item>Airline Name: {{ flightRoute.data?.airline?.name }}</mat-list-item>
          <mat-list-item>
            Airline Country: {{ flightRoute.data?.airline?.country }}
          </mat-list-item>
        </mat-list>
        <mat-list>
          <mat-list-item>
            <span matListItemTitle>Origin Details</span>
          </mat-list-item>
          <mat-list-item>Country: {{flightRoute.data?.origin?.country_name}}</mat-list-item>
          <mat-list-item>Airport Name: {{flightRoute.data?.origin?.name}}</mat-list-item>
        </mat-list>
        <mat-list>
          <mat-list-item>
            <span matListItemTitle>Destination Details</span>
          </mat-list-item>
          <mat-list-item>Country: {{flightRoute.data?.destination?.country_name}}</mat-list-item>
          <mat-list-item>Airport Name: {{flightRoute.data?.destination?.name}}</mat-list-item>
        </mat-list>

      </mat-card-content>
      }
    </mat-card>
    } } @else {
    <p class="txt_center">Welcome to Flight search service!</p>
    }
  </div>

  }

  <!-- <div class="results">
    @for (result of results(); track result.query) {
    <mat-card>
      <mat-card-header>
        <mat-card-title>{{ result.query }} ({{ result.type }})</mat-card-title>
        <p>{{ result | json }}</p>
      </mat-card-header>
      <mat-card-content>
        @if (result.error) {
        <p class="error">{{ result.error }}</p>
        } @if(aircraftResults) { @for (aircraft of aircraftResults; track
        aircraft.data) {
        <p>{{ aircraft | json }}</p>
        } } @if(flightRouteResults) { @for (flightRoute of flightRouteResults;
        track flightRoute.type) {
        <p>
          {{ flightRoute | json }}
        </p>
        } }
      </mat-card-content>
    </mat-card>
    }
  </div> -->
</div>

<!-- @else { @if (result.type === 'aircraft') { @if
        (result.data?.url_photo) {
        <img
          [src]="result.data?.url_photo"
          alt="Aircraft Photo"
          class="photo"
        />
        }
        <mat-list>
          <mat-list-item>Type: {{ result.data?.type }}</mat-list-item>
          <mat-list-item
            >Manufacturer: {{ result.data?.manufacturer }}</mat-list-item
          >
          <mat-list-item
            >Registration: {{ result.data?.registration }}</mat-list-item
          >
          <mat-list-item
            >Owner: {{ result.data?.registered_owner }}</mat-list-item
          >
          <mat-divider></mat-divider>
        </mat-list>
        } @else {
        <mat-list>
          <mat-list-item>Callsign: {{ result.data?.callsign }}</mat-list-item>
          <mat-list-item
            >Airline: {{ result.data?.airline?.name || "N/A" }}</mat-list-item
          >
          <mat-list-item
            >Origin: {{ result.data?.origin.name }} ({{
              result.data?.origin.iata_code
            }})</mat-list-item
          >
          <mat-list-item
            >Destination: {{ result.data?.destination.name }} ({{
              result.data?.destination.iata_code
            }})</mat-list-item
          >
          @if (result.data?.midpoint) {
          <mat-list-item
            >Midpoint: {{ result.data?.midpoint.name }} ({{
              result.data??.midpoint.iata_code

            }})</mat-list-item
          >
          }
          <mat-divider></mat-divider>
        </mat-list>
        } } -->